<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lions Karate Club â€“ Bill Generator</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- jsPDF & html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        :root {
            --primary: #1a365d;
            --secondary:#4a5568;
            --accent:#4299e1;
            --bg:#f7fafc;
            --card:#ffffff;
            --text:#2d3748;
        }

        body {
            font-family: 'Inter', sans-serif;
            background:#f7fafc;
            color:#2d3748;
        }

        .receipt-preview{
            box-shadow:0 4px 8px rgba(0,0,0,.05);
            border-radius:.5rem;
        }

        .striped-row:nth-child(even){background:#f0f9ff;}

        .toast{
            position:fixed;
            bottom:1.5rem;
            right:1.5rem;
            padding:.75rem 1.5rem;
            border-radius:.375rem;
            color:#fff;
            font-weight:500;
            box-shadow:0 4px 6px rgba(0,0,0,.1);
            opacity:0;
            transform:translateY(100px);
            transition:all .2s ease;
            z-index:1000;
        }
        .toast.show{opacity:1;transform:translateY(0);}
        .toast.success{background:#10b981;}
        .toast.error{background:#ef4444;}

        .spinner{
            width:24px;height:24px;
            border:3px solid rgba(255,255,255,.3);
            border-top-color:#fff;
            border-radius:50%;
            animation:spin 1s linear infinite;
        }
        @keyframes spin{to{transform:rotate(360deg);}}

        .btn-hover-effect{transition:.3s;}
        .btn-hover-effect:hover{transform:translateY(-2px);box-shadow:0 4px 6px rgba(0,0,0,.1);}

        .input-focus-effect:focus{
            box-shadow:0 0 0 3px rgba(59,130,246,.3);
        }

        .mobile-menu{
            max-height:0;overflow:hidden;
            transition:max-height .3s ease-out;
        }
        .mobile-menu.open{max-height:500px;}

        .pdf-receipt{
            font-family:'Inter',sans-serif;
            font-size:12px;
            max-width:210mm;
            padding:10mm;
        }
        .pdf-receipt table{font-size:11px;width:100%;}
        .pdf-receipt th,.pdf-receipt td{padding:4px 6px;}
        .pdf-receipt .logo{width:70px;height:70px;object-fit:contain;}
        .pdf-receipt .qr-code{width:120px;height:120px;object-fit:contain;}
    </style>
</head>
<body class="bg-gray-50">

<!-- ==================== Toast ==================== -->
<div id="toast" class="toast hidden"><span id="toastMessage"></span></div>

<div class="container mx-auto px-4 py-8">

    <!-- =============== Mobile Header =============== -->
    <div class="lg:hidden mb-6">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <div class="w-12 h-12 rounded-full bg-red-600 flex items-center justify-center mr-3 shadow-lg">
                    <i class="fas fa-lion text-white text-2xl"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-gray-800">Lions Karate Club</h1>
                    <p class="text-xs text-gray-600">Pune, Maharashtra</p>
                </div>
            </div>
            <button id="mobileMenuToggle"
                    class="p-2 rounded-lg bg-gray-100 text-gray-700">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </div>

        <!-- Mobile menu -->
        <div id="mobileMenu" class="mobile-menu bg-white rounded-lg shadow-lg mt-3 p-4 hidden">
            <button id="mobileMonthlyTab"
                    class="w-full py-2 mb-2 bg-gradient-to-r from-blue-600 to-blue-500 text-white rounded flex items-center justify-between px-3">
                <span><i class="fas fa-calendar-alt mr-2"></i>Monthly/Admission</span>
                <i class="fas fa-arrow-right"></i>
            </button>
            <button id="mobileExamTab"
                    class="w-full py-2 mb-2 bg-gray-100 text-gray-800 rounded flex items-center justify-between px-3">
                <span><i class="fas fa-medal mr-2"></i>Belt Exam Fee</span>
                <i class="fas fa-arrow-right"></i>
            </button>
            <button id="mobileOtherTab"
                    class="w-full py-2 bg-gray-100 text-gray-800 rounded flex items-center justify-between px-3">
                <span><i class="fas fa-file-invoice mr-2"></i>Other Invoice</span>
                <i class="fas fa-arrow-right"></i>
            </button>

            <div class="mt-4 pt-4 border-t border-gray-200">
                <h3 class="text-sm font-semibold mb-2 flex items-center">
                    <i class="fas fa-info-circle mr-2 text-blue-600"></i>Club Info
                </h3>
                <p class="flex items-center text-xs text-gray-600 mb-1"><i class="fas fa-phone mr-2 text-blue-500"></i>Phone: 9049688172</p>
                <p class="flex items-center text-xs text-gray-600"><i class="fas fa-map-marker-alt mr-2 text-blue-500"></i>Pune, Maharashtra</p>
            </div>
        </div>
    </div>

    <!-- =============== Desktop Header =============== -->
    <header class="hidden lg:block text-center mb-8">
        <div class="flex justify-center mb-4">
            <div class="w-16 h-16 rounded-full bg-red-600 flex items-center justify-center shadow-lg animate-pulse">
                <i class="fas fa-lion text-white text-3xl"></i>
            </div>
        </div>
        <h1 class="text-4xl font-bold text-gray-800 mb-2 animate-slide-in">Lions Karate Club</h1>
        <p class="text-xl text-gray-600">Pune, Maharashtra</p>
        <p class="text-lg text-blue-600">Registration No: PU000121240</p>
        <p class="text-lg text-blue-600 mt-2">Bill Generator System</p>
    </header>

    <div class="flex flex-col lg:flex-row gap-8">

        <!-- =============== Sidebar (Desktop) =============== -->
        <aside class="hidden lg:block w-1/4">
            <nav class="bg-white rounded-xl shadow-md p-6 sticky top-4">
                <h2 class="text-xl font-semibold mb-6 flex items-center text-gray-800">
                    <i class="fas fa-receipt mr-2 text-blue-600"></i>Receipt Types
                </h2>

                <div class="space-y-3">
                    <button id="monthlyTab"
                            class="w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-blue-500 text-white rounded flex items-center justify-between">
                        <span><i class="fas fa-calendar-alt mr-2"></i>Monthly/Admission</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>

                    <button id="examTab"
                            class="w-full py-3 px-4 bg-gray-100 text-gray-800 rounded flex items-center justify-between">
                        <span><i class="fas fa-medal mr-2"></i>Belt Exam Fee</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>

                    <button id="otherTab"
                            class="w-full py-3 px-4 bg-gray-100 text-gray-800 rounded flex items-center justify-between">
                        <span><i class="fas fa-file-invoice mr-2"></i>Other Invoice</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>

                <div class="mt-8 pt-4 border-t border-gray-200">
                    <h3 class="text-lg font-semibold mb-2 flex items-center">
                        <i class="fas fa-info-circle mr-2 text-blue-600"></i>Club Info
                    </h3>
                    <p class="flex items-center text-sm text-gray-600 mb-1"><i class="fas fa-phone mr-2 text-blue-500"></i>Phone: 9049688172</p>
                    <p class="flex items-center text-sm text-gray-600"><i class="fas fa-map-marker-alt mr-2 text-blue-500"></i>Pune, Maharashtra</p>
                </div>

                <div class="mt-6 pt-4 border-t border-gray-200">
                    <h3 class="text-lg font-semibold mb-2 flex items-center">
                        <i class="fas fa-history mr-2 text-blue-600"></i>Recent Receipts
                    </h3>
                    <div id="recentReceipts" class="text-sm text-gray-600">
                        <p class="italic text-gray-500">No recent receipts yet</p>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- ================== Main Content ================== -->
        <main class="flex-1">

            <!-- =============== Monthly / Admission =============== -->
            <section id="monthlyForm" class="bg-white rounded-xl shadow-sm p-6 mb-8 border border-gray-200">
                <div class="flex items-center mb-6">
                    <div class="p-3 mr-4 bg-blue-100 text-blue-600 rounded">
                        <i class="fas fa-calendar-alt text-xl"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">Monthly/Admission Fee</h2>
                        <p class="text-gray-600">Generate receipts for monthly fees and admissions</p>
                    </div>
                </div>

                <form id="monthlyReceiptForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="studentName" class="block text-sm font-medium text-gray-700 mb-1 flex items-center"><i class="fas fa-user mr-2 text-blue-500"></i>Student Name</label>
                            <input type="text" id="studentName" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 input-focus-effect" placeholder="Enter student name" required>
                        </div>
                        <div>
                            <label for="receiptDate" class="block text-sm font-medium text-gray-700 mb-1 flex items-center"><i class="fas fa-calendar-day mr-2 text-blue-500"></i>Date</label>
                            <input type="date" id="receiptDate" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 input-focus-effect" required>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label for="monthlyFee" class="block text-sm font-medium text-gray-700 mb-1 flex items-center"><i class="fas fa-rupee-sign mr-2 text-blue-500"></i>Monthly Fee (â‚¹)</label>
                            <input type="number" id="monthlyFee" min="0" step="0.01" value="0"
                                   class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 input-focus-effect">
                        </div>
                        <div>
                            <label for="admissionFee" class="block text-sm font-medium text-gray-700 mb-1 flex items-center"><i class="fas fa-sign-in-alt mr-2 text-blue-500"></i>Admission Fee (â‚¹)</label>
                            <input type="number" id="admissionFee" min="0" step="0.01" value="0"
                                   class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 input-focus-effect">
                        </div>
                        <div>
                            <label for="otherCharges" class="block text-sm font-medium text-gray-700 mb-1 flex items-center"><i class="fas fa-plus-circle mr-2 text-blue-500"></i>Other Charges (â‚¹)</label>
                            <input type="number" id="otherCharges" min="0" step="0.01" value="0"
                                   class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 input-focus-effect">
                        </div>
                    </div>

                    <div>
                        <label for="notes" class="block text-sm font-medium text-gray-700 mb-1 flex items-center"><i class="fas fa-sticky-note mr-2 text-blue-500"></i>Notes</label>
                        <textarea id="notes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 input-focus-effect" placeholder="Additional notes (optional)"></textarea>
                    </div>

                    <div class="flex justify-end space-x-4 pt-2">
                        <button type="reset" class="px-6 py-2 bg-gray-700 text-gray-200 rounded hover:bg-gray-600 flex items-center btn-hover-effect"><i class="fas fa-redo mr-2"></i>Reset</button>
                        <button type="button" id="generateMonthlyReceipt"
                                class="px-6 py-2 bg-gradient-to-r from-blue-600 to-blue-500 text-white rounded hover:from-blue-700 hover:to-blue-600 flex items-center btn-hover-effect"><i class="fas fa-file-invoice-dollar mr-2"></i>Generate Receipt</button>
                    </div>
                </form>
            </section>

            <!-- =============== Belt Exam Fee =============== -->
            <section id="examForm" class="bg-white rounded-xl shadow-sm p-6 mb-8 border border-gray-200 hidden">
                <div class="flex items-center mb-6">
                    <div class="p-3 mr-4 bg-purple-100 text-purple-600 rounded">
                        <i class="fas fa-medal text-xl"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">Belt Exam Fee</h2>
                        <p class="text-gray-600">Generate receipts for belt examination fees</p>
                    </div>
                </div>

                <form id="examReceiptForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="examStudentName" class="block text-sm font-medium text-gray-700 mb-1 flex items-center"><i class="fas fa-user mr-2 text-purple-500"></i>Student Name</label>
                            <input type="text" id="examStudentName" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 input-focus-effect" placeholder="Enter student name" required>
                        </div>
                        <div>
                            <label for="examDate" class="block text-sm font-medium text-gray-700 mb-1 flex items-center"><i class="fas fa-calendar-day mr-2 text-purple-500"></i>Exam Date</label>
                            <input type="date" id="examDate" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 input-focus-effect" required>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="appliedBelt" class="block text-sm font-medium text-gray-700 mb-1 flex items-center"><i class="fas fa-belt mr-2 text-purple-500"></i>Applied Belt</label>
                            <select id="appliedBelt" class="w-full px-4 py-2 border border-gray-300 rounded appearance-none focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 input-focus-effect">
                                <option value="White Belt">White Belt</option>
                                <option value="Yellow Belt">Yellow Belt</option>
                                <option value="Orange Belt">Orange Belt</option>
                                <option value="Green Belt">Green Belt</option>
                                <option value="Blue Belt">Blue Belt</option>
                                <option value="Purple Belt">Purple Belt</option>
                                <option value="Brown Belt">Brown Belt</option>
                                <option value="Black Belt">Black Belt</option>
                            </select>
                        </div>
                        <div>
                            <label for="examFee" class="block text-sm font-medium text-gray-700 mb-1 flex items-center"><i class="fas fa-rupee-sign mr-2 text-purple-500"></i>Exam Fee (â‚¹)</label>
                            <input type="number" id="examFee" min="0" step="0.01" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 input-focus-effect" required>
                        </div>
                    </div>

                    <div class="flex justify-end space-x-4 pt-2">
                        <button type="reset" class="px-6 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 flex items-center btn-hover-effect"><i class="fas fa-redo mr-2"></i>Reset</button>
                        <button type="button" id="generateExamReceipt"
                                class="px-6 py-2 bg-gradient-to-r from-purple-600 to-purple-500 text-white rounded hover:from-purple-700 hover:to-purple-600 flex items-center btn-hover-effect"><i class="fas fa-file-invoice-dollar mr-2"></i>Generate Receipt</button>
                    </div>
                </form>
            </section>

            <!-- =============== Other Invoice =============== -->
            <section id="otherForm" class="bg-white rounded-xl shadow-sm p-6 mb-8 border border-gray-200 hidden">
                <div class="flex items-center mb-6">
                    <div class="p-3 mr-4 bg-green-100 text-green-600 rounded">
                        <i class="fas fa-file-invoice text-xl"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">Other Invoice</h2>
                        <p class="text-gray-600">Create custom invoices with multiple items</p>
                    </div>
                </div>

                <form id="otherInvoiceForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="otherStudentName" class="block text-sm font-medium text-gray-700 mb-1 flex items-center"><i class="fas fa-user mr-2 text-green-500"></i>Student Name</label>
                            <input type="text" id="otherStudentName" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 input-focus-effect" placeholder="Enter student name" required>
                        </div>
                        <div>
                            <label for="otherDate" class="block text-sm font-medium text-gray-700 mb-1 flex items-center"><i class="fas fa-calendar-day mr-2 text-green-500"></i>Date</label>
                            <input type="date" id="otherDate" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 input-focus-effect" required>
                        </div>
                    </div>

                    <!-- Items -->
                    <div>
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-sm font-medium flex items-center text-gray-700"><i class="fas fa-list mr-2 text-green-500"></i>Items</h3>
                            <button type="button" id="addItem" class="px-3 py-1 bg-green-100 text-green-700 rounded hover:bg-green-200 flex items-center"><i class="fas fa-plus mr-1"></i>Add Item</button>
                        </div>

                        <div id="itemsContainer" class="space-y-4">
                            <!-- One item row by default -->
                            <div class="item-row grid grid-cols-1 md:grid-cols-12 gap-4 items-end">
                                <div class="md:col-span-5">
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Description</label>
                                    <input type="text" class="item-description w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 input-focus-effect" placeholder="Item description" required>
                                </div>
                                <div class="md:col-span-3">
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Qty</label>
                                    <input type="number" class="item-quantity w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 input-focus-effect" value="1" min="1" required>
                                </div>
                                <div class="md:col-span-3">
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Price (â‚¹)</label>
                                    <input type="number" class="item-price w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 input-focus-effect" value="0" min="0" step="0.01" required>
                                </div>
                                <div class="md:col-span-1 flex items-center">
                                    <button type="button" class="remove-item w-full h-10 flex items-center justify-center text-red-500 hover:text-red-700 rounded hover:bg-red-50 transition"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label for="otherNotes" class="block text-sm font-medium text-gray-700 mb-1 flex items-center"><i class="fas fa-sticky-note mr-2 text-green-500"></i>Notes</label>
                        <textarea id="otherNotes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 input-focus-effect" placeholder="Additional notes (optional)"></textarea>
                    </div>

                    <div class="flex justify-end space-x-4 pt-2">
                        <button type="reset" class="px-6 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 flex items-center btn-hover-effect"><i class="fas fa-redo mr-2"></i>Reset</button>
                        <button type="button" id="generateOtherReceipt"
                                class="px-6 py-2 bg-gradient-to-r from-green-600 to-green-500 text-white rounded hover:from-green-700 hover:to-green-600 flex items-center btn-hover-effect"><i class="fas fa-file-invoice-dollar mr-2"></i>Generate Invoice</button>
                    </div>
                </form>
            </section>

            <!-- =============== Receipt Preview =============== -->
            <section id="receiptPreviewSection" class="bg-white rounded-xl shadow-sm p-6 border border-gray-200 hidden">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center">
                        <div class="p-3 mr-4 bg-green-100 text-green-600 rounded">
                            <i class="fas fa-file-invoice text-xl"></i>
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800">Receipt Preview</h2>
                            <p class="text-gray-600">Review before downloading</p>
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button id="printReceipt"
                                class="px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 flex items-center btn-hover-effect"><i class="fas fa-print mr-2"></i>Print</button>
                        <button id="downloadPdf"
                                class="px-4 py-2 bg-gradient-to-r from-green-600 to-green-500 text-white rounded hover:from-green-700 hover:to-green-600 flex items-center btn-hover-effect"><i class="fas fa-file-pdf mr-2"></i>Download PDF</button>
                    </div>
                </div>

                <div id="receiptPreview" class="receipt-preview bg-white p-6 rounded border border-gray-200 text-gray-800">
                    <!-- Receipt HTML will be injected here -->
                </div>
            </section>

        </main>
    </div>
</div>

<script>
    // ***** Helper functions *****
    const { jsPDF } = window.jspdf;

    // Toast notifications ----------------------------------------------------
    function showToast(message, type = 'success') {
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        toastMessage.textContent = message;
        toast.className = `toast ${type} show`;
        setTimeout(() => { toast.className = 'toast hidden'; }, 3000);
    }

    // Mobile menu ------------------------------------------------------------
    function initMobileMenu() {
        const toggle = document.getElementById('mobileMenuToggle');
        const menu = document.getElementById('mobileMenu');
        if (toggle && menu) {
            toggle.addEventListener('click', () => {
                menu.classList.toggle('open');
                menu.classList.toggle('hidden');
            });
        }
    }

    // Tab switching -----------------------------------------------------------
    function switchTab(tab) {
        // Hide all sections
        document.getElementById('monthlyForm').classList.add('hidden');
        document.getElementById('examForm').classList.add('hidden');
        document.getElementById('otherForm').classList.add('hidden');
        document.getElementById('receiptPreviewSection').classList.add('hidden');

        // Reset tab styles
        const resetTab = (el) => {
            if (!el) return;
            el.classList.remove('bg-gradient-to-r', 'from-blue-600', 'to-blue-500', 'from-purple-600', 'to-purple-500', 'from-green-600', 'to-green-500', 'text-white');
            el.classList.add('bg-gray-100', 'text-gray-800');
        };
        resetTab(document.getElementById('monthlyTab'));
        resetTab(document.getElementById('examTab'));
        resetTab(document.getElementById('otherTab'));
        resetTab(document.getElementById('mobileMonthlyTab'));
        resetTab(document.getElementById('mobileExamTab'));
        resetTab(document.getElementById('mobileOtherTab'));

        // Activate the chosen tab + show section
        const activate = (tabEl, gradientFrom, gradientTo) => {
            if (!tabEl) return;
            tabEl.classList.remove('bg-gray-100', 'text-gray-800');
            tabEl.classList.add('bg-gradient-to-r', gradientFrom, gradientTo, 'text-white');
        };

        if (tab === 'monthly') {
            document.getElementById('monthlyForm').classList.remove('hidden');
            activate(document.getElementById('monthlyTab'), 'from-blue-600', 'to-blue-500');
            activate(document.getElementById('mobileMonthlyTab'), 'from-blue-600', 'to-blue-500');
        } else if (tab === 'exam') {
            document.getElementById('examForm').classList.remove('hidden');
            activate(document.getElementById('examTab'), 'from-purple-600', 'to-purple-500');
            activate(document.getElementById('mobileExamTab'), 'from-purple-600', 'to-purple-500');
        } else if (tab === 'other') {
            document.getElementById('otherForm').classList.remove('hidden');
            activate(document.getElementById('otherTab'), 'from-green-600', 'to-green-500');
            activate(document.getElementById('mobileOtherTab'), 'from-green-600', 'to-green-500');
        }

        // Close mobile menu if open
        const mobileMenu = document.getElementById('mobileMenu');
        if (mobileMenu && mobileMenu.classList.contains('open')) {
            mobileMenu.classList.remove('open');
            mobileMenu.classList.add('hidden');
        }
    }

    function initTabSwitching() {
        // Desktop tabs
        document.getElementById('monthlyTab').addEventListener('click', () => switchTab('monthly'));
        document.getElementById('examTab').addEventListener('click', () => switchTab('exam'));
        document.getElementById('otherTab').addEventListener('click', () => switchTab('other'));

        // Mobile tabs
        document.getElementById('mobileMonthlyTab').addEventListener('click', () => switchTab('monthly'));
        document.getElementById('mobileExamTab').addEventListener('click', () => switchTab('exam'));
        document.getElementById('mobileOtherTab').addEventListener('click', () => switchTab('other'));
    }

    // Default dates -----------------------------------------------------------
    function setDefaultDates() {
        const today = new Date().toISOString().split('T')[0];
        ['receiptDate', 'examDate', 'otherDate'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.value = today;
        });
    }

    // Invoice number generator (yearly incremental) -------------------------
    function getNextInvoiceNumber(prefix) {
        const now = new Date();
        const year = now.getFullYear();
        const key = `${prefix}_${year}`;
        let last = parseInt(localStorage.getItem(key) || '0', 10);
        last += 1;
        localStorage.setItem(key, String(last));
        return `${prefix}-${year}-${String(last).padStart(3, '0')}`;
    }

    // Recent receipts ---------------------------------------------------------
    function saveRecentReceipt(type, name, amount, date) {
        const list = JSON.parse(localStorage.getItem('recentReceipts') || '[]');

        // Keep only last 5
        if (list.length >= 5) list.pop();

        list.unshift({ type, name, amount, date });
        localStorage.setItem('recentReceipts', JSON.stringify(list));
        renderRecentReceipts();
    }

    function renderRecentReceipts() {
        const container = document.getElementById('recentReceipts');
        if (!container) return;

        const list = JSON.parse(localStorage.getItem('recentReceipts') || '[]');
        if (list.length === 0) {
            container.innerHTML = `<p class="italic text-gray-500">No recent receipts yet</p>`;
            return;
        }

        let html = '';
        list.forEach(r => {
            const date = new Date(r.date).toLocaleDateString('en-IN', {
                day: '2-digit', month: 'short', year: 'numeric'
            });
            let badgeClass = 'bg-blue-100 text-blue-800';
            let icon = 'fa-calendar-alt';

            if (r.type === 'exam') { badgeClass='bg-purple-100 text-purple-800'; icon='fa-medal'; }
            if (r.type === 'other') { badgeClass='bg-green-100 text-green-800'; icon='fa-file-invoice'; }

            html += `
                <div class="flex items-center justify-between py-2 border-b border-gray-200">
                    <div>
                        <p class="font-medium text-gray-800">${r.name}</p>
                        <p class="text-xs text-gray-500">${date}</p>
                    </div>
                    <div class="flex items-center text-sm ${badgeClass} px-2 py-1 rounded">
                        <i class="fas ${icon} mr-1"></i>â‚¹${r.amount.toFixed(2)}
                    </div>
                </div>
            `;
        });
        container.innerHTML = html;
    }

    // Add / Remove item (Other Invoice) -------------------------------------
    function initAddItem() {
        const addBtn = document.getElementById('addItem');
        addBtn?.addEventListener('click', () => {
            const container = document.getElementById('itemsContainer');
            if (!container) return;

            const newRow = document.createElement('div');
            newRow.className = 'item-row grid grid-cols-1 md:grid-cols-12 gap-4 items-end';
            newRow.innerHTML = `
                <div class="md:col-span-5">
                    <label class="block text-xs font-medium text-gray-700 mb-1">Description</label>
                    <input type="text" class="item-description w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 input-focus-effect" placeholder="Item description" required>
                </div>
                <div class="md:col-span-3">
                    <label class="block text-xs font-medium text-gray-700 mb-1">Qty</label>
                    <input type="number" class="item-quantity w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 input-focus-effect" value="1" min="1" required>
                </div>
                <div class="md:col-span-3">
                    <label class="block text-xs font-medium text-gray-700 mb-1">Price (â‚¹)</label>
                    <input type="number" class="item-price w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 input-focus-effect" value="0" min="0" step="0.01" required>
                </div>
                <div class="md:col-span-1 flex items-center">
                    <button type="button" class="remove-item w-full h-10 flex items-center justify-center text-red-500 hover:text-red-700 rounded hover:bg-red-50 transition"><i class="fas fa-trash"></i></button>
                </div>
            `;
            container.appendChild(newRow);
        });
    }

    // Delegated remove item handler (so it works for dynamic rows)
    function initRemoveItem() {
        document.addEventListener('click', (e) => {
            if (e.target.closest('.remove-item')) {
                const row = e.target.closest('.item-row');
                const container = document.getElementById('itemsContainer');
                if (container.children.length > 1) {
                    container.removeChild(row);
                } else {
                    showToast('At least one item is required', 'error');
                }
            }
        });
    }

    // Generate Monthly Receipt -------------------------------------------------
    function initGenerateMonthlyReceipt() {
        const btn = document.getElementById('generateMonthlyReceipt');
        btn?.addEventListener('click', () => {
            const name = document.getElementById('studentName').value.trim();
            const date = document.getElementById('receiptDate').value;
            const monthly = parseFloat(document.getElementById('monthlyFee').value) || 0;
            const admission = parseFloat(document.getElementById('admissionFee').value) || 0;
            const other = parseFloat(document.getElementById('otherCharges').value) || 0;
            const notes = document.getElementById('notes').value.trim();

            if (!name || !date) {
                showToast('Please fill in all required fields', 'error');
                return;
            }

            const total = monthly + admission + other;
            const invNo = getNextInvoiceNumber('INV');
            const formattedDate = new Date(date).toLocaleDateString('en-IN', {
                day: '2-digit', month: 'short', year: 'numeric'
            });

            // Build table rows only for nonâ€‘zero items
            let rows = '';
            if (monthly > 0) rows += `<tr class="striped-row"><td class="font-medium py-2 px-3">Monthly Fee</td><td class="text-right py-2 px-3">â‚¹${monthly.toFixed(2)}</td></tr>`;
            if (admission > 0) rows += `<tr class="striped-row"><td class="font-medium py-2 px-3">Admission Fee</td><td class="text-right py-2 px-3">â‚¹${admission.toFixed(2)}</td></tr>`;
            if (other > 0) rows += `<tr class="striped-row"><td class="font-medium py-2 px-3">Other Charges</td><td class="text-right py-2 px-3">â‚¹${other.toFixed(2)}</td></tr>`;

            const receiptHTML = `
                <div class="pdf-receipt">
                    <div class="text-center mb-6">
                        <img src="https://i.postimg.cc/FsCCfVFX/LIONS-l-OGO.png" alt="Club Logo" class="logo mb-2">
                        <h1 class="text-xl font-bold">Lions Karate Club â€“ Pune</h1>
                        <p class="text-xs text-gray-600">Phone: 9049688172 | Pune, Maharashtra</p>
                        <p class="text-xs text-gray-600">Registration No: PU000121240</p>
                    </div>
                    <div class="flex justify-between text-xs mb-4">
                        <div>
                            <p><strong>Invoice No:</strong> ${invNo}<br><strong>Date:</strong> ${formattedDate}</p>
                        </div>
                        <div class="text-right">
                            <p><strong>Student Name:</strong><br>${name}</p>
                        </div>
                    </div>
                    <table class="w-full border-collapse">
                        <thead class="bg-gray-100">
                            <tr><th class="text-left py-2">Description</th><th class="text-right py-2">Amount (â‚¹)</th></tr>
                        </thead>
                        <tbody>
                            ${rows}
                            <tr class="bg-gray-800 text-white font-bold">
                                <td class="py-2 px-3 text-right">Total</td>
                                <td class="py-2 px-3 text-right">â‚¹${total.toFixed(2)}</td>
                            </tr>
                        </tbody>
                    </table>
                    ${notes ? `<div class="mt-4 p-2 bg-gray-50 rounded"><strong>Notes:</strong> ${notes}</div>` : ''}
                    <div class="mt-6 pt-4 border-t border-gray-200 text-center">
                        <img src="https://i.postimg.cc/ht9xFK5Z/Whats-App-Image-2025-08-08-at-14-45-04-69c782b8.jpg" alt="QR Code" class="qr-code mx-auto mb-2">
                        <p class="text-xs text-gray-600">Scan QR code to pay</p>
                        <p class="mt-2 text-xs text-gray-600">Thank you for your payment!</p>
                        <p class="mt-2 text-xs text-gray-600">Generated by Lions Karate Club Bill Generator</p>
                        <p class="mt-1 text-xs text-gray-500">${new Date().toLocaleString()}</p>
                    </div>
                </div>
            `;

            const preview = document.getElementById('receiptPreview');
            preview.innerHTML = receiptHTML;
            document.getElementById('receiptPreviewSection').classList.remove('hidden');

            saveRecentReceipt('monthly', name, total, date);
            preview.scrollIntoView({ behavior: 'smooth' });
            showToast('Receipt generated successfully!');
        });
    }

    // Generate Exam Receipt ----------------------------------------------------
    function initGenerateExamReceipt() {
        const btn = document.getElementById('generateExamReceipt');
        btn?.addEventListener('click', () => {
            const name = document.getElementById('examStudentName').value.trim();
            const date = document.getElementById('examDate').value;
            const belt = document.getElementById('appliedBelt').value;
            const fee = parseFloat(document.getElementById('examFee').value) || 0;

            if (!name || !date || fee <= 0) {
                showToast('Please fill in all required fields', 'error');
                return;
            }

            const invNo = getNextInvoiceNumber('EXAM');
            const formattedDate = new Date(date).toLocaleDateString('en-IN', {
                day: '2-digit', month: 'short', year: 'numeric'
            });

            const beltClass = `belt-${belt.split(' ')[0].toLowerCase()}`;

            const receiptHTML = `
                <div class="pdf-receipt">
                    <div class="text-center mb-6">
                        <img src="https://i.postimg.cc/FsCCfVFX/LIONS-l-OGO.png" alt="Club Logo" class="logo mb-2">
                        <h1 class="text-xl font-bold">Lions Karate Club â€“ Pune</h1>
                        <p class="text-xs text-gray-600">Phone: 9049688172 | Pune, Maharashtra</p>
                        <p class="text-xs text-gray-600">Registration No: PU000121240</p>
                    </div>
                    <div class="flex justify-between text-xs mb-4">
                        <div>
                            <p><strong>Receipt No:</strong> ${invNo}<br><strong>Date:</strong> ${formattedDate}</p>
                        </div>
                        <div class="text-right">
                            <p><strong>Student Name:</strong><br>${name}</p>
                        </div>
                    </div>
                    <table class="w-full border-collapse">
                        <thead class="bg-gray-100">
                            <tr><th class="text-left py-2">Description</th><th class="text-right py-2">Amount (â‚¹)</th></tr>
                        </thead>
                        <tbody>
                            <tr class="striped-row"><td class="py-2 px-3">${belt} Exam Fee</td><td class="text-right py-2 px-3">â‚¹${fee.toFixed(2)}</td></tr>
                            <tr class="bg-gray-800 text-white font-bold">
                                <td class="py-2 px-3 text-right">Total</td>
                                <td class="py-2 px-3 text-right">â‚¹${fee.toFixed(2)}</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="mt-4 p-2 bg-purple-50 rounded text-sm">
                        <p><strong>Exam Details:</strong></p>
                        <p class="flex items-center"><span class="${beltClass} mr-2 px-2 py-1 rounded text-xs font-medium">${belt}</span>Exam on ${formattedDate}</p>
                    </div>
                    <div class="mt-6 pt-4 border-t border-gray-200 text-center">
                        <img src="https://i.postimg.cc/ht9xFK5Z/Whats-App-Image-2025-08-08-at-14-45-04-69c782b8.jpg" alt="QR Code" class="qr-code mx-auto mb-2">
                        <p class="text-xs text-gray-600">Scan QR code to pay</p>
                        <p class="mt-2 text-xs text-gray-600">Thank you for your payment!</p>
                        <p class="mt-2 text-xs text-gray-600">Generated by Lions Karate Club Bill Generator</p>
                        <p class="mt-1 text-xs text-gray-500">${new Date().toLocaleString()}</p>
                    </div>
                </div>
            `;

            const preview = document.getElementById('receiptPreview');
            preview.innerHTML = receiptHTML;
            document.getElementById('receiptPreviewSection').classList.remove('hidden');

            saveRecentReceipt('exam', name, fee, date);
            preview.scrollIntoView({ behavior: 'smooth' });
            showToast('Exam receipt generated successfully!');
        });
    }

    // Generate Other Invoice ---------------------------------------------------
    function initGenerateOtherReceipt() {
        const btn = document.getElementById('generateOtherReceipt');
        btn?.addEventListener('click', () => {
            const name = document.getElementById('otherStudentName').value.trim();
            const date = document.getElementById('otherDate').value;
            const notes = document.getElementById('otherNotes').value.trim();

            if (!name || !date) {
                showToast('Please fill in all required fields', 'error');
                return;
            }

            // Gather items
            const rows = document.querySelectorAll('.item-row');
            let itemsHTML = '';
            let total = 0;
            let hasValidItem = false;

            rows.forEach(row => {
                const desc = row.querySelector('.item-description').value.trim();
                const qty = parseInt(row.querySelector('.item-quantity').value, 10) || 0;
                const price = parseFloat(row.querySelector('.item-price').value) || 0;
                const amount = qty * price;

                if (desc && qty > 0 && price > 0) {
                    hasValidItem = true;
                    total += amount;
                    itemsHTML += `
                        <tr class="striped-row">
                            <td class="py-2 px-3">${desc}</td>
                            <td class="py-2 px-3 text-center">${qty}</td>
                            <td class="py-2 px-3 text-right">â‚¹${price.toFixed(2)}</td>
                            <td class="py-2 px-3 text-right">â‚¹${amount.toFixed(2)}</td>
                        </tr>`;
                }
            });

            if (!hasValidItem) {
                showToast('Please add at least one valid item', 'error');
                return;
            }

            const invNo = getNextInvoiceNumber('OTHER');
            const formattedDate = new Date(date).toLocaleDateString('en-IN', {
                day: '2-digit', month: 'short', year: 'numeric'
            });

            const receiptHTML = `
                <div class="pdf-receipt">
                    <div class="text-center mb-6">
                        <img src="https://i.postimg.cc/FsCCfVFX/LIONS-l-OGO.png" alt="Club Logo" class="logo mb-2">
                        <h1 class="text-xl font-bold">Lions Karate Club â€“ Pune</h1>
                        <p class="text-xs text-gray-600">Phone: 9049688172 | Pune, Maharashtra</p>
                        <p class="text-xs text-gray-600">Registration No: PU000121240</p>
                    </div>
                    <div class="flex justify-between text-xs mb-4">
                        <div>
                            <p><strong>Invoice No:</strong> ${invNo}<br><strong>Date:</strong> ${formattedDate}</p>
                        </div>
                        <div class="text-right">
                            <p><strong>Student Name:</strong><br>${name}</p>
                        </div>
                    </div>
                    <table class="w-full border-collapse">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="py-2 text-left">Description</th>
                                <th class="py-2 text-center">Qty</th>
                                <th class="py-2 text-right">Price (â‚¹)</th>
                                <th class="py-2 text-right">Amount (â‚¹)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHTML}
                            <tr class="bg-gray-800 text-white font-bold">
                                <td colspan="3" class="py-2 px-3 text-right">Total</td>
                                <td class="py-2 px-3 text-right">â‚¹${total.toFixed(2)}</td>
                            </tr>
                        </tbody>
                    </table>
                    ${notes ? `<div class="mt-4 p-2 bg-gray-50 rounded"><strong>Notes:</strong> ${notes}</div>` : ''}
                    <div class="mt-6 pt-4 border-t border-gray-200 text-center">
                        <img src="https://i.postimg.cc/ht9xFK5Z/Whats-App-Image-2025-08-08-at-14-45-04-69c782b8.jpg" alt="QR Code" class="qr-code mx-auto mb-2">
                        <p class="text-xs text-gray-600">Scan QR code to pay</p>
                        <p class="mt-2 text-xs text-gray-600">Thank you for your payment!</p>
                        <p class="mt-2 text-xs text-gray-600">Generated by Lions Karate Club Bill Generator</p>
                        <p class="mt-1 text-xs text-gray-500">${new Date().toLocaleString()}</p>
                    </div>
                </div>
            `;

            const preview = document.getElementById('receiptPreview');
            preview.innerHTML = receiptHTML;
            document.getElementById('receiptPreviewSection').classList.remove('hidden');

            saveRecentReceipt('other', name, total, date);
            preview.scrollIntoView({ behavior: 'smooth' });
            showToast('Invoice generated successfully!');
        });
    }

    // PDF download ------------------------------------------------------------
    function initDownloadPdf() {
        const btn = document.getElementById('downloadPdf');
        btn?.addEventListener('click', () => {
            const receipt = document.getElementById('receiptPreview');
            if (!receipt) {
                showToast('No receipt to download', 'error');
                return;
            }

            // Show loading state
            const originalHTML = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner mr-2"></div>Downloading...';

            html2canvas(receipt, {scale:2,useCORS:true}).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p','mm','a4');

                const imgProps = pdf.getImageProperties(imgData);
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

                pdf.addImage(imgData,'PNG',0,0,pdfWidth,pdfHeight);
                const filename = receipt.innerHTML.includes('Exam') ?
                    `belt_exam_${Date.now()}.pdf` :
                    `invoice_${Date.now()}.pdf`;

                pdf.save(filename);
                showToast('PDF downloaded successfully!');
            }).catch(err => {
                console.error(err);
                showToast('Failed to generate PDF', 'error');
            }).finally(() => {
                btn.disabled = false;
                btn.innerHTML = originalHTML;
            });
        });
    }

    // Print receipt ------------------------------------------------------------
    function initPrintReceipt() {
        const btn = document.getElementById('printReceipt');
        btn?.addEventListener('click', () => {
            const receipt = document.getElementById('receiptPreview');
            if (!receipt) {
                showToast('No receipt to print', 'error');
                return;
            }

            const win = window.open('', '_blank', 'width=800,height=600');
            win.document.write(`
                <html>
                <head>
                    <title>Print Receipt</title>
                    <link rel="stylesheet"
                          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
                    <style>
                        body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:20px;}
                        .pdf-receipt{font-size:12px;}
                    </style>
                </head>
                <body>${receipt.innerHTML}</body>
                </html>
            `);
            win.document.close();
            setTimeout(() => win.print(), 300);
        });
    }

    // Initialize everything ----------------------------------------------------
    document.addEventListener('DOMContentLoaded', () => {
        initMobileMenu();
        initTabSwitching();
        setDefaultDates();
        initAddItem();
        initRemoveItem();
        initGenerateMonthlyReceipt();
        initGenerateExamReceipt();
        initGenerateOtherReceipt();
        initDownloadPdf();
        initPrintReceipt();
        renderRecentReceipts();
    });
</script>
</body>
</html>
